<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>타자 스토리 어드벤처 - 우주 테마</title>

    <style>
        :root{
            --bg:#f6f7fb;
            --panel:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --shadow: 0 16px 50px rgba(17,24,39,.10);
            --radius:18px;

            --brand:#2563eb;
            --brand2:#60a5fa;

            --good:#16a34a;
            --bad:#ef4444;
            --warn:#f59e0b;

            --soft:#fbfbfd;
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            display:flex;
            align-items:center;
            justify-content:center;
            padding: 14px;
            overflow-x:hidden;
        }

        /* ===== Background: subtle “space” but white theme ===== */
        .starfield,
        .gradient-bg{
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .gradient-bg{
            background:
                    radial-gradient(900px 520px at 15% 15%, rgba(37,99,235,.12), transparent 60%),
                    radial-gradient(900px 520px at 85% 25%, rgba(96,165,250,.10), transparent 60%),
                    radial-gradient(900px 520px at 40% 90%, rgba(245,158,11,.10), transparent 60%);
            opacity: .95;
        }

        .starfield{
            background:
                    radial-gradient(circle at 10% 20%, rgba(17,24,39,.10) 0 1.5px, transparent 2px) 0 0/160px 160px,
                    radial-gradient(circle at 70% 30%, rgba(37,99,235,.12) 0 1.5px, transparent 2px) 0 0/220px 220px,
                    radial-gradient(circle at 40% 80%, rgba(17,24,39,.08) 0 1.5px, transparent 2px) 0 0/260px 260px;
            opacity: .8;
            filter: blur(.1px);
        }

        /* ===== Main container ===== */
        .story-container{
            width: min(860px, 100%);
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 22px;
            box-shadow: var(--shadow);
            padding: 16px;
            position: relative;
            z-index: 1;
        }

        /* Story (built text) */
        #story-text-area{
            border: 1px solid var(--border);
            border-radius: 18px;
            background: var(--soft);
            padding: 14px;
            min-height: 120px;
        }
        #story-text-area h2{
            margin: 0 0 10px;
            font-size: 18px;
            font-weight: 900;
            letter-spacing: -0.3px;
        }
        #story-text-area p{
            margin: 0 0 10px;
            color: var(--text);
            line-height: 1.55;
            font-weight: 700;
            font-size: 14px;
        }
        #story-text-area p:last-child{ margin-bottom: 0; }

        /* Prompt list */
        #prompt-list-area{
            margin-top: 12px;
            display:flex;
            flex-direction: column;
            gap: 8px;
        }

        .sentence-item{
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 10px 12px;
            background: #fff;
            font-size: 13px;
            font-weight: 800;
            color: var(--text);
            transition: transform .05s ease, background .15s ease, border-color .15s ease;
        }

        .sentence-completed{
            background: rgba(22,163,74,.08);
            border-color: rgba(22,163,74,.20);
            color: #14532d;
        }

        .sentence-current{
            background: rgba(37,99,235,.08);
            border-color: rgba(37,99,235,.25);
            box-shadow: 0 10px 24px rgba(37,99,235,.10);
        }

        .sentence-upcoming{
            background: #fff;
            color: #374151;
            opacity: .85;
        }

        /* Input */
        .input-area{ margin-top: 14px; }

        .input-field{
            width:100%;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            font-size: 15px;
            outline:none;
            transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
            background:#fff;
        }
        .input-field:focus{
            border-color: rgba(37,99,235,.55);
            box-shadow: 0 0 0 4px rgba(37,99,235,.12);
        }
        .input-field:disabled{
            background:#f3f4f6;
            color:#9ca3af;
            cursor:not-allowed;
        }

        /* partial/correct/incorrect states */
        .input-correct-partial{
            border-color: rgba(22,163,74,.40);
            box-shadow: 0 0 0 4px rgba(22,163,74,.10);
        }
        .input-incorrect{
            border-color: rgba(239,68,68,.55);
            box-shadow: 0 0 0 4px rgba(239,68,68,.12);
        }

        /* Message */
        .message-box{
            margin-top: 10px;
            min-height: 22px;
            font-size: 13px;
            font-weight: 900;
            color: var(--muted);
        }
        .message-correct{ color: var(--good); }
        .message-incorrect{ color: var(--bad); }
        .message-info{ color: var(--warn); }

        /* Buttons */
        .button-container{
            margin-top: 14px;
            display:flex;
            gap: 10px;
            justify-content:flex-end;
            flex-wrap: wrap;
        }

        .game-button{
            border: 1px solid transparent;
            border-radius: 16px;
            padding: 12px 14px;
            font-weight: 900;
            font-size: 14px;
            cursor:pointer;
            transition: transform .05s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
            user-select:none;
            min-width: 120px;
        }
        .game-button:active{ transform: translateY(1px); }

        .start-button{
            background: var(--brand);
            color:#fff;
            box-shadow: 0 12px 28px rgba(37,99,235,.22);
        }
        .start-button:hover{ background:#1d4ed8; }

        .restart-button{
            background:#fff;
            color: var(--text);
            border-color: var(--border);
        }
        .restart-button:hover{ background:#f9fafb; }

        .hidden{ display:none !important; }

        @media (max-width: 520px){
            body{ padding: 12px; }
            .story-container{ padding: 14px; }
            .button-container{ justify-content:stretch; }
            .game-button{ width:100%; min-width:0; }
        }
    </style>
</head>

<body>
<div class="starfield"></div>
<div class="gradient-bg"></div>

<div class="story-container">
    <div id="story-text-area">
        <p>모험을 시작하려면 '시작' 버튼을 누르세요.</p>
    </div>

    <div id="prompt-list-area"></div>

    <div class="input-area">
        <input
                type="text"
                id="word-input"
                class="input-field"
                placeholder="여기에 문장 입력..."
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                disabled
        />
    </div>

    <div id="message-box" class="message-box"></div>

    <div class="button-container">
        <button id="start-button" class="game-button start-button">시작</button>
        <button id="restart-button" class="game-button restart-button hidden">다시 시작</button>
    </div>
</div>

<script>
    // DOM Elements
    const storyTextArea = document.getElementById('story-text-area');
    const promptListArea = document.getElementById('prompt-list-area');
    const wordInput = document.getElementById('word-input');
    const messageBox = document.getElementById('message-box');
    const startButton = document.getElementById('start-button');
    const restartButton = document.getElementById('restart-button');

    // Story Data Structure
    const storyLevels = [
        {
            id: 1,
            levelName: "오리온 성운의 부름",
            sentences: [
                "고요한 우주, 관제탑에서 경고음이 울립니다.",
                "미확인 신호가 오리온 성운 방향에서 감지되었습니다.",
                "탐사선 '개척자 호'는 즉시 출격 준비를 합니다.",
                "새로운 임무는 미지의 신호를 추적하는 것입니다."
            ]
        },
        {
            id: 2,
            levelName: "소행성 지대 통과",
            sentences: [
                "개척자 호는 소행성 지대에 진입합니다.",
                "크고 작은 암석들이 함선을 위협합니다.",
                "정교한 조종으로 위험을 회피해야 합니다.",
                "레이더에 거대한 물체가 포착되었습니다."
            ]
        },
        {
            id: 3,
            levelName: "고대 외계 유적",
            sentences: [
                "거대한 물체는 고대 외계 문명의 유적이었습니다.",
                "유적 내부에서 강력한 에너지 반응이 느껴집니다.",
                "신호의 근원지가 바로 이곳일지도 모릅니다.",
                "조심스럽게 내부 탐사를 시작합니다."
            ]
        }
    ];

    // Game State Variables
    let currentLevelIndex = 0;
    let currentSentenceInLevelIndex = 0;
    let isPlaying = false;
    let currentLevelStoryContent = "";

    // Event Listeners
    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', restartGame);
    wordInput.addEventListener('input', handleInput);

    // Enter 방지 + Enter로 판정(원래 로직 유지)
    wordInput.addEventListener('keydown', (e) => {
        if (e.key !== 'Enter' || !isPlaying) return;

        e.preventDefault();

        if (currentLevelIndex < storyLevels.length &&
            currentSentenceInLevelIndex < storyLevels[currentLevelIndex].sentences.length) {

            const expectedSentence = storyLevels[currentLevelIndex].sentences[currentSentenceInLevelIndex];

            if (wordInput.value === expectedSentence) {
                processCorrectSentence();
            } else {
                messageBox.textContent = '문장이 일치하지 않습니다!';
                messageBox.className = 'message-box message-incorrect';
                wordInput.classList.add('input-incorrect');
            }
        }
    });

    // Game Logic Functions
    function startGame() {
        isPlaying = true;
        currentLevelIndex = 0;
        messageBox.textContent = '';
        messageBox.className = 'message-box';
        wordInput.disabled = false;
        wordInput.value = '';
        wordInput.classList.remove('input-correct-partial', 'input-incorrect');
        startButton.classList.add('hidden');
        restartButton.classList.add('hidden');

        displayCurrentLevel();
        setTimeout(() => wordInput.focus(), 50);
    }

    function displayCurrentLevel() {
        if (currentLevelIndex >= storyLevels.length) {
            endGame(true);
            return;
        }
        currentSentenceInLevelIndex = 0;
        currentLevelStoryContent = "";

        const levelData = storyLevels[currentLevelIndex];
        storyTextArea.innerHTML = `<h2>${escapeHtml(levelData.levelName)}</h2>`;
        updatePromptAndInputForSentence();
    }

    function updatePromptAndInputForSentence() {
        promptListArea.innerHTML = '';

        if (currentLevelIndex >= storyLevels.length) {
            endGame(true);
            return;
        }

        const levelData = storyLevels[currentLevelIndex];
        const allSentencesForThisLevel = levelData.sentences;

        if (currentSentenceInLevelIndex >= allSentencesForThisLevel.length) {
            messageBox.textContent = `${levelData.levelName} 완료! 다음 임무 준비 중...`;
            messageBox.className = 'message-box message-info';

            currentLevelIndex++;
            wordInput.value = '';
            wordInput.disabled = true;

            setTimeout(() => {
                if (isPlaying) displayCurrentLevel();
            }, 1600);

            return;
        }

        const expectedSentence = allSentencesForThisLevel[currentSentenceInLevelIndex];

        allSentencesForThisLevel.forEach((sentence, index) => {
            const sentenceEl = document.createElement('div');
            sentenceEl.classList.add('sentence-item');
            sentenceEl.textContent = sentence;

            if (index < currentSentenceInLevelIndex) sentenceEl.classList.add('sentence-completed');
            else if (index === currentSentenceInLevelIndex) sentenceEl.classList.add('sentence-current');
            else sentenceEl.classList.add('sentence-upcoming');

            promptListArea.appendChild(sentenceEl);
        });

        wordInput.placeholder = `"${expectedSentence.substring(0, 15)}..." 입력`;
        wordInput.disabled = false;
        wordInput.value = '';
        wordInput.classList.remove('input-correct-partial', 'input-incorrect');

        setTimeout(() => wordInput.focus(), 0);
    }

    function handleInput() {
        if (!isPlaying ||
            currentLevelIndex >= storyLevels.length ||
            currentSentenceInLevelIndex >= storyLevels[currentLevelIndex].sentences.length) return;

        const typedValue = wordInput.value;
        const expectedSentence = storyLevels[currentLevelIndex].sentences[currentSentenceInLevelIndex];
        if (!expectedSentence) return;

        if (expectedSentence.startsWith(typedValue) && typedValue !== "") {
            wordInput.classList.remove('input-incorrect');
            wordInput.classList.add('input-correct-partial');
            messageBox.textContent = '';
            messageBox.className = 'message-box';
        } else if (typedValue !== "") {
            wordInput.classList.remove('input-correct-partial');
            wordInput.classList.add('input-incorrect');
            messageBox.textContent = '주의! 다릅니다.';
            messageBox.className = 'message-box message-incorrect';
        } else {
            wordInput.classList.remove('input-correct-partial', 'input-incorrect');
            messageBox.textContent = '';
            messageBox.className = 'message-box';
        }

        if (typedValue === expectedSentence) {
            processCorrectSentence();
        }
    }

    function processCorrectSentence() {
        messageBox.textContent = '정확합니다!';
        messageBox.className = 'message-box message-correct';

        currentLevelStoryContent += `<p>${escapeHtml(storyLevels[currentLevelIndex].sentences[currentSentenceInLevelIndex])}</p>`;
        storyTextArea.innerHTML = `<h2>${escapeHtml(storyLevels[currentLevelIndex].levelName)}</h2>${currentLevelStoryContent}`;

        currentSentenceInLevelIndex++;
        wordInput.value = '';

        setTimeout(() => {
            if (isPlaying) updatePromptAndInputForSentence();
        }, 320);
    }

    function endGame(allLevelsCompleted = false) {
        isPlaying = false;
        wordInput.disabled = true;
        promptListArea.innerHTML = '';

        if (allLevelsCompleted) {
            storyTextArea.innerHTML += "<br><p><strong>모든 임무를 완료했습니다! 우주 영웅이 되셨군요!</strong></p>";
            messageBox.textContent = '모든 레벨 클리어!';
        } else {
            storyTextArea.innerHTML += "<br><p><strong>- 통신 두절 -</strong></p>";
            messageBox.textContent = '게임이 종료되었습니다.';
        }

        messageBox.className = 'message-box message-info';
        restartButton.classList.remove('hidden');
    }

    function restartGame() {
        startButton.classList.remove('hidden');
        restartButton.classList.add('hidden');

        storyTextArea.innerHTML = "<p>새로운 임무를 시작하려면 '시작' 버튼을 누르세요.</p>";
        promptListArea.innerHTML = '';
        messageBox.textContent = '';
        messageBox.className = 'message-box';

        wordInput.value = '';
        wordInput.disabled = true;
        wordInput.placeholder = "여기에 문장 입력...";
        wordInput.classList.remove('input-correct-partial', 'input-incorrect');

        currentLevelIndex = 0;
        currentSentenceInLevelIndex = 0;
        currentLevelStoryContent = "";
        isPlaying = false;
    }

    function escapeHtml(str){
        return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
</script>
</body>
</html>
