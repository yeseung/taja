<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ïö∞Ï£º ÌÉÄÏûê - Ïö∞Ï£º ÎîîÌéúÏä§</title>

    <style>
        :root{
            --bg:#f6f7fb;
            --panel:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --shadow: 0 16px 50px rgba(17,24,39,.10);
            --radius:18px;

            --brand:#2563eb;
            --brand2:#60a5fa;

            --good:#16a34a;
            --bad:#ef4444;
            --warn:#f59e0b;

            --soft:#fbfbfd;
            --chip:#f3f4f6;
        }

        *{ box-sizing:border-box; }
        html,body{ height:100%; }
        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x:hidden;
        }

        /* ===== Background ===== */
        .starfield, .gradient-bg{
            position: fixed;
            inset: 0;
            pointer-events:none;
            z-index:0;
        }
        .gradient-bg{
            background:
                    radial-gradient(900px 520px at 15% 15%, rgba(37,99,235,.12), transparent 60%),
                    radial-gradient(900px 520px at 85% 25%, rgba(96,165,250,.10), transparent 60%),
                    radial-gradient(900px 520px at 40% 90%, rgba(245,158,11,.10), transparent 60%);
            opacity:.95;
        }
        .starfield{
            background:
                    radial-gradient(circle at 10% 20%, rgba(17,24,39,.10) 0 1.5px, transparent 2px) 0 0/160px 160px,
                    radial-gradient(circle at 70% 30%, rgba(37,99,235,.12) 0 1.5px, transparent 2px) 0 0/220px 220px,
                    radial-gradient(circle at 40% 80%, rgba(17,24,39,.08) 0 1.5px, transparent 2px) 0 0/260px 260px;
            opacity:.8;
            filter: blur(.1px);
        }

        /* ===== Layout ===== */
        .container{
            position: relative;
            z-index: 1;
            width: min(920px, 100%);
            margin: 0 auto;
            padding: 18px 16px 28px;
            min-height: 100vh;
            display:flex;
            flex-direction: column;
            gap: 14px;
        }

        .nav-buttons{ display:flex; justify-content:flex-start; }
        .back-btn{
            border: 1px solid var(--border);
            background:#fff;
            color: var(--text);
            border-radius: 999px;
            padding: 10px 12px;
            font-weight: 900;
            cursor:pointer;
            box-shadow: 0 10px 26px rgba(17,24,39,.06);
            transition: background .15s ease, transform .05s ease;
        }
        .back-btn:hover{ background:#f9fafb; }
        .back-btn:active{ transform: translateY(1px); }

        .text-center{ text-align:center; }
        .my-md{ margin: 6px 0 8px; }

        .logo{
            margin: 6px 0 4px;
            font-size: 22px;
            letter-spacing: 1.6px;
            font-weight: 900;
        }
        .tagline{
            margin:0;
            color: var(--muted);
            font-size: 13px;
            font-weight: 800;
        }

        /* ===== Header stats ===== */
        .game-header{
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 14px;
        }

        .game-stats{
            display:grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .game-stat{
            background: #fbfbfd;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 12px;
            text-align:center;
        }

        .game-stat-value{
            font-weight: 900;
            font-size: 18px;
            letter-spacing: -0.4px;
        }
        .game-stat-label{
            margin-top: 4px;
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
        }

        /* ===== Game world ===== */
        .game-world{
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            height: 320px;
            position: relative;
            overflow:hidden;
        }

        /* path line */
        .path{
            position:absolute;
            left:0; right:0;
            bottom: 62px;
            height: 8px;
            background: linear-gradient(90deg, rgba(37,99,235,.15), rgba(96,165,250,.12));
            border-top: 1px dashed rgba(37,99,235,.25);
            border-bottom: 1px dashed rgba(37,99,235,.18);
        }

        /* goal base */
        .goal{
            position:absolute;
            left: 10px;
            bottom: 44px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: rgba(37,99,235,.10);
            border: 1px solid rgba(37,99,235,.25);
            display:flex;
            align-items:center;
            justify-content:center;
            font-size: 22px;
            box-shadow: 0 12px 26px rgba(37,99,235,.10);
        }
        .goal::before{ content:"üõ°Ô∏è"; }
        .goal.goal-hit{
            animation: goalHit .35s ease;
            border-color: rgba(239,68,68,.45);
            background: rgba(239,68,68,.10);
        }
        @keyframes goalHit{
            0%{ transform: translateX(0) scale(1); }
            40%{ transform: translateX(-3px) scale(1.04); }
            100%{ transform: translateX(0) scale(1); }
        }

        /* enemy */
        .enemy{
            position:absolute;
            bottom: 48px;
            display:flex;
            flex-direction: column;
            align-items:center;
            justify-content:center;
            gap: 6px;
            min-width: 64px;
            padding: 10px 10px 8px;
            border-radius: 16px;
            background: #fff;
            border: 1px solid var(--border);
            box-shadow: 0 12px 26px rgba(17,24,39,.08);
            transform: translateZ(0);
            user-select:none;
            will-change: left, transform, opacity;
        }
        .enemy .enemy-word{
            font-size: 12px;
            font-weight: 900;
            color: var(--text);
            background: var(--chip);
            border: 1px solid rgba(17,24,39,.06);
            padding: 6px 10px;
            border-radius: 999px;
            line-height: 1;
            white-space: nowrap;
        }
        .enemy.destroyed{
            animation: popOut .35s ease forwards;
        }
        @keyframes popOut{
            0%{ transform: scale(1); opacity: 1; }
            100%{ transform: scale(1.25); opacity: 0; }
        }

        /* ===== message ===== */
        .message-box{
            min-height: 22px;
            font-size: 13px;
            font-weight: 900;
            color: var(--muted);
            text-align:center;
            padding: 2px 0;
        }

        /* ===== input ===== */
        .input-area{ }
        .defense-input{
            width:100%;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            font-size: 16px;
            outline:none;
            background:#fff;
            transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease;
        }
        .defense-input:focus{
            border-color: rgba(37,99,235,.55);
            box-shadow: 0 0 0 4px rgba(37,99,235,.12);
        }
        .defense-input:disabled{
            background:#f3f4f6;
            color:#9ca3af;
            cursor:not-allowed;
        }

        /* ===== difficulty selector ===== */
        .difficulty-selector{
            display:flex;
            gap: 10px;
            justify-content:center;
            flex-wrap:wrap;
        }
        .difficulty-btn{
            border: 1px solid var(--border);
            background:#fff;
            color: var(--text);
            border-radius: 999px;
            padding: 10px 12px;
            font-weight: 900;
            cursor:pointer;
            transition: background .15s ease, transform .05s ease, border-color .15s ease;
        }
        .difficulty-btn:hover{ background:#f9fafb; }
        .difficulty-btn:active{ transform: translateY(1px); }
        .difficulty-btn.active{
            border-color: rgba(37,99,235,.35);
            background: rgba(37,99,235,.08);
            color: #1d4ed8;
        }

        /* ===== controls ===== */
        .controls{
            display:flex;
            gap: 10px;
            justify-content:center;
            flex-wrap:wrap;
            margin-top: 2px;
        }
        .btn{
            border: 1px solid transparent;
            border-radius: 16px;
            padding: 12px 14px;
            font-weight: 900;
            cursor:pointer;
            font-size: 14px;
            min-width: 120px;
            transition: transform .05s ease, box-shadow .15s ease, background .15s ease, border-color .15s ease;
            user-select:none;
        }
        .btn:active{ transform: translateY(1px); }
        .btn:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none !important; }

        .btn-primary{
            background: var(--brand);
            color:#fff;
            box-shadow: 0 12px 28px rgba(37,99,235,.22);
        }
        .btn-primary:hover{ background:#1d4ed8; }

        .btn-outline{
            background:#fff;
            color: var(--text);
            border-color: var(--border);
        }
        .btn-outline:hover{ background:#f9fafb; }

        /* ===== Result modal ===== */
        .result-modal{
            position: fixed;
            inset: 0;
            background: rgba(17,24,39,.42);
            display:none;
            align-items:center;
            justify-content:center;
            padding: 18px;
            z-index: 50;
            backdrop-filter: blur(6px);
        }
        .result-modal.active{ display:flex; }

        .result-content{
            width: min(720px, 100%);
            background:#fff;
            border: 1px solid var(--border);
            border-radius: 20px;
            box-shadow: 0 22px 70px rgba(17,24,39,.24);
            padding: 18px;
        }
        .result-title{
            margin: 2px 0 12px;
            font-size: 18px;
            font-weight: 900;
            text-align:center;
        }
        .result-stats{
            display:grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0 14px;
        }
        .result-stat{
            background: #fbfbfd;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 12px;
            text-align:center;
        }
        .result-stat-value{
            font-weight: 900;
            font-size: 18px;
            letter-spacing: -0.4px;
        }
        .result-stat-label{
            margin-top: 4px;
            font-size: 12px;
            color: var(--muted);
            font-weight: 800;
        }
        .result-buttons{
            display:flex;
            gap: 10px;
            justify-content:center;
            flex-wrap:wrap;
            margin-top: 6px;
        }

        @media (max-width: 520px){
            .game-stats{ grid-template-columns: 1fr; }
            .result-stats{ grid-template-columns: 1fr; }
            .btn{ width:100%; min-width:0; }
            .game-world{ height: 300px; }
        }
    </style>
</head>

<body>
<div class="starfield"></div>
<div class="gradient-bg"></div>

<div class="container" style="min-height: 100vh;">
    <div class="nav-buttons">
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Î©îÏù∏ÏúºÎ°ú</button>
    </div>

    <div class="text-center my-md">
        <h1 class="logo">SPACE DEFENSE</h1>
        <p class="tagline">Ïö∞Ï£º ÎîîÌéúÏä§ Í≤åÏûÑ</p>
    </div>

    <div class="game-header">
        <div class="game-stats">
            <div class="game-stat">
                <div class="game-stat-value" id="score">0</div>
                <div class="game-stat-label">Ï†êÏàò</div>
            </div>
            <div class="game-stat">
                <div class="game-stat-value" id="lives">10</div>
                <div class="game-stat-label">Î≥¥Ìò∏Îßâ</div>
            </div>
            <div class="game-stat">
                <div class="game-stat-value" id="wave">0</div>
                <div class="game-stat-label">Ïõ®Ïù¥Î∏å</div>
            </div>
        </div>
    </div>

    <div class="game-world" id="game-world">
        <div class="path"></div>
        <div class="goal" id="goal"></div>
        <!-- enemies injected -->
    </div>

    <div id="message-box" class="message-box">ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨ Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!</div>

    <div class="input-area">
        <input
                type="text"
                id="word-input"
                class="defense-input"
                placeholder="Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÏó¨ Ïô∏Í≥ÑÏù∏ Í≤©Ìá¥!"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                disabled
        />
    </div>

    <div class="difficulty-selector">
        <button class="difficulty-btn active" data-difficulty="easy">Ï¥àÍ∏â</button>
        <button class="difficulty-btn" data-difficulty="medium">Ï§ëÍ∏â</button>
        <button class="difficulty-btn" data-difficulty="hard">Í≥†Í∏â</button>
    </div>

    <div class="controls">
        <button class="btn btn-primary" id="start-btn">ÏãúÏûë</button>
        <button class="btn btn-outline" id="reset-btn" disabled>Ï¥àÍ∏∞Ìôî</button>
    </div>
</div>

<div class="result-modal" id="result-modal">
    <div class="result-content">
        <h2 class="result-title">Í≤åÏûÑ Ï¢ÖÎ£å!</h2>

        <div class="result-stats">
            <div class="result-stat">
                <div class="result-stat-value" id="result-score">0</div>
                <div class="result-stat-label">ÏµúÏ¢Ö Ï†êÏàò</div>
            </div>
            <div class="result-stat">
                <div class="result-stat-value" id="result-wave">0</div>
                <div class="result-stat-label">ÏµúÏ¢Ö Ïõ®Ïù¥Î∏å</div>
            </div>
            <div class="result-stat">
                <div class="result-stat-value" id="result-enemies">0</div>
                <div class="result-stat-label">Ï≤òÏπòÌïú Ï†Å</div>
            </div>
            <div class="result-stat">
                <div class="result-stat-value" id="result-accuracy">0%</div>
                <div class="result-stat-label">Ï†ïÌôïÎèÑ</div>
            </div>
        </div>

        <div class="result-buttons">
            <button class="btn btn-primary" id="try-again-btn">Îã§Ïãú ÎèÑÏ†Ñ</button>
            <button class="btn btn-outline" onclick="window.location.href='index.html'">Î©îÏù∏ÏúºÎ°ú</button>
        </div>
    </div>
</div>

<script>
    // DOM
    const gameWorld = document.getElementById('game-world');
    const goal = document.getElementById('goal');
    const scoreDisplay = document.getElementById('score');
    const livesDisplay = document.getElementById('lives');
    const waveDisplay = document.getElementById('wave');
    const wordInput = document.getElementById('word-input');
    const messageBox = document.getElementById('message-box');
    const startButton = document.getElementById('start-btn');
    const resetButton = document.getElementById('reset-btn');
    const difficultyButtons = document.querySelectorAll('.difficulty-btn');
    const resultModal = document.getElementById('result-modal');
    const resultScoreElement = document.getElementById('result-score');
    const resultWaveElement = document.getElementById('result-wave');
    const resultEnemiesElement = document.getElementById('result-enemies');
    const resultAccuracyElement = document.getElementById('result-accuracy');
    const tryAgainButton = document.getElementById('try-again-btn');

    // Words
    const words = [
        'Ïö∞Ï£º','Î≥Ñ','ÌñâÏÑ±','Îã¨','ÏßÄÍµ¨','ÌÉúÏñë','Îπõ','Î∞§','ÎÇÆ','ÌïòÎäò',
        'Î≥ÑÏûêÎ¶¨','ÏùÄÌïò','Î¨¥Ï§ëÎ†•','Î°úÏºì','ÌÉêÏÇ¨','Î∞úÏÇ¨','Í∂§ÎèÑ','Ï∞©Î•ô',
        'Í∏∞ÏßÄ','Ïö∞Ï£ºÏù∏','Ïã†Ìò∏','ÌÉêÌóò','Í¥ÄÏ∏°','ÎßùÏõêÍ≤Ω','Î≥ÑÎò•Î≥Ñ','ÌòúÏÑ±',
        'Ïú†ÏÑ±','Ìï≠Ìï¥','ÏÑ±Ïö¥','Ï§ëÎ†•','Ïö∞Ï£ºÎ≥µ','ÏúÑÏÑ±','Î∞úÍ≤¨','Ïó∞Íµ¨',
        'Ïö∞Ï£ºÏÑ†','Ï≤úÎ¨∏Ìïô','Î∏îÎûôÌôÄ','Ïù∏Í≥µÏúÑÏÑ±','Ï†ïÍ±∞Ïû•','Ï¥àÏã†ÏÑ±','Ïô∏Í≥ÑÏù∏',
        'ÏÜåÌñâÏÑ±','ÏôúÏÑ±','Ï§ëÏÑ±ÏûêÎ≥Ñ','ÌÄòÏù¥ÏÇ¨','ÎπÖÎ±Ö','ÏïîÌùëÎ¨ºÏßà'
    ];

    // Enemies
    const enemyTypes = [
        { sprite:"üëæ", speed:1.0, hp:5,  points:10 },
        { sprite:"üëΩ", speed:1.5, hp:3,  points:15 },
        { sprite:"üêô", speed:0.8, hp:10, points:20 },
        { sprite:"üöÄ", speed:2.0, hp:2,  points:25 },
        { sprite:"üõ∏", speed:1.0, hp:12, points:30 }
    ];

    // Game State
    const MAX_LIVES = 10;
    let score = 0;
    let lives = MAX_LIVES;
    let wave = 0;
    let enemies = [];
    let isPlaying = false;
    let gameInterval;
    let waveInterval;

    let baseSpeed = 1;
    let enemiesThisWave = 0;
    let enemiesSpawnedThisWave = 0;

    let enemiesDefeated = 0;
    let totalWordAttempts = 0;
    let correctWordAttempts = 0;

    let currentDifficulty = 'easy';

    const WAVE_DELAY = 4500;
    const SPAWN_INTERVAL = 1500;

    const difficultySettings = {
        easy:   { baseSpeed: 1.0, spawnRate: 1.0, enemiesMultiplier: 3, speedIncrease: 0.05 },
        medium: { baseSpeed: 1.2, spawnRate: 1.2, enemiesMultiplier: 4, speedIncrease: 0.08 },
        hard:   { baseSpeed: 1.5, spawnRate: 1.5, enemiesMultiplier: 5, speedIncrease: 0.10 }
    };

    // Events
    startButton.addEventListener('click', startGame);
    resetButton.addEventListener('click', resetGame);

    // EnterÎ°ú Ï†úÏ∂ú
    wordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            checkWord();
        }
    });

    tryAgainButton.addEventListener('click', () => {
        closeModal();
        resetGame();
        startGame();
    });

    // Difficulty buttons
    difficultyButtons.forEach(btn => {
        btn.addEventListener('click', function(){
            if (this.classList.contains('active')) return;
            difficultyButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentDifficulty = this.dataset.difficulty;
            if (isPlaying) resetGame();
        });
    });

    // Modal close on backdrop
    resultModal.addEventListener('click', (e) => {
        if (e.target === resultModal) closeModal();
    });

    function openModal(){ resultModal.classList.add('active'); }
    function closeModal(){ resultModal.classList.remove('active'); }

    // Start
    function startGame(){
        if (isPlaying) return;

        isPlaying = true;
        score = 0;
        lives = MAX_LIVES;
        wave = 0;
        enemies = [];
        enemiesDefeated = 0;
        totalWordAttempts = 0;
        correctWordAttempts = 0;

        // difficulty base
        baseSpeed = difficultySettings[currentDifficulty].baseSpeed;

        // clear dom enemies
        document.querySelectorAll('.enemy').forEach(el => el.remove());

        // UI
        scoreDisplay.textContent = score;
        livesDisplay.textContent = lives;
        waveDisplay.textContent = wave;
        messageBox.textContent = 'Ï§ÄÎπÑÌïòÏÑ∏Ïöî...';

        // input
        wordInput.disabled = false;
        wordInput.value = '';
        wordInput.placeholder = 'Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÏó¨ Ïô∏Í≥ÑÏù∏ Í≤©Ìá¥!';

        // buttons
        startButton.disabled = true;
        resetButton.disabled = false;

        // loop
        gameInterval = setInterval(gameLoop, 30);

        setTimeout(() => {
            startNextWave();
            wordInput.focus();
        }, 1200);
    }

    function gameLoop(){
        if (!isPlaying) return;
        moveEnemies();
        checkGoalReached();
    }

    function startNextWave(){
        if (!isPlaying) return;

        wave++;
        waveDisplay.textContent = wave;

        const settings = difficultySettings[currentDifficulty];
        enemiesThisWave = 5 + wave * settings.enemiesMultiplier;
        enemiesSpawnedThisWave = 0;
        baseSpeed = settings.baseSpeed + (wave * settings.speedIncrease);

        flashMessage(`Ïπ®Îûµ ${wave} Ïõ®Ïù¥Î∏å!`, 1200);

        clearTimeout(waveInterval);
        spawnEnemyForWave();
    }

    function spawnEnemyForWave(){
        if (!isPlaying || enemiesSpawnedThisWave >= enemiesThisWave){
            checkWaveEndCondition();
            return;
        }

        spawnEnemy();
        enemiesSpawnedThisWave++;

        if (enemiesSpawnedThisWave < enemiesThisWave){
            const settings = difficultySettings[currentDifficulty];
            const spawnDelay = SPAWN_INTERVAL / settings.spawnRate;
            waveInterval = setTimeout(spawnEnemyForWave, Math.max(300, spawnDelay));
        } else {
            setTimeout(checkWaveEndCondition, SPAWN_INTERVAL);
        }
    }

    function spawnEnemy(){
        const typeIndex = Math.floor(Math.random() * enemyTypes.length);
        const enemyType = enemyTypes[typeIndex];

        const enemyEl = document.createElement('div');
        enemyEl.classList.add('enemy');
        enemyEl.textContent = enemyType.sprite;

        // word pool by difficulty
        let wordPool = [...words];
        if (currentDifficulty === 'medium' || currentDifficulty === 'hard'){
            wordPool = wordPool.filter(w => currentDifficulty === 'medium' ? w.length >= 2 : w.length >= 3);
            if (wordPool.length === 0) wordPool = [...words];
        }
        const word = wordPool[Math.floor(Math.random() * wordPool.length)];

        const wordEl = document.createElement('div');
        wordEl.classList.add('enemy-word');
        wordEl.textContent = word;
        enemyEl.appendChild(wordEl);

        enemyEl.style.left = gameWorld.offsetWidth + 'px';
        const randomOffsetY = Math.random() * 18 - 9;
        enemyEl.style.bottom = (50 + randomOffsetY) + 'px';

        gameWorld.appendChild(enemyEl);

        enemies.push({
            element: enemyEl,
            word,
            hp: enemyType.hp,
            speed: enemyType.speed * baseSpeed,
            points: enemyType.points,
            typeIndex,
            destroyed: false
        });
    }

    function moveEnemies(){
        for (let i = enemies.length - 1; i >= 0; i--){
            const e = enemies[i];
            if (e.destroyed) continue;
            const el = e.element;
            let left = parseInt(el.style.left || gameWorld.offsetWidth, 10);
            left -= e.speed;
            el.style.left = left + 'px';
        }
    }

    function checkGoalReached(){
        const goalEdge = goal.offsetWidth + 10; // a bit forgiving
        for (let i = enemies.length - 1; i >= 0; i--){
            const e = enemies[i];
            if (e.destroyed) continue;
            const left = parseInt(e.element.style.left, 10);
            if (left <= goalEdge){
                handleGoalReached(e, i);
            }
        }
    }

    function handleGoalReached(enemyData, index){
        if (enemyData.destroyed) return;

        lives--;
        livesDisplay.textContent = lives;

        goal.classList.add('goal-hit');
        setTimeout(() => goal.classList.remove('goal-hit'), 450);

        enemyData.destroyed = true;
        enemyData.element.remove();
        enemies.splice(index, 1);

        if (lives <= 0){
            endGame();
        } else {
            flashMessage(`Ï†Å ÌÜµÍ≥º! Î≥¥Ìò∏Îßâ ${lives} ÎÇ®Ïùå`, 1100);
            checkWaveEndCondition();
        }
    }

    function checkWord(){
        if (!isPlaying) return;

        const typed = wordInput.value.trim();
        if (!typed) return;

        totalWordAttempts++;

        // closest-to-goal first
        const targetable = enemies
        .filter(e => !e.destroyed)
        .sort((a,b) => parseInt(a.element.style.left,10) - parseInt(b.element.style.left,10));

        let hit = false;

        for (let i = 0; i < targetable.length; i++){
            const e = targetable[i];
            if (e.word === typed){
                const idx = enemies.findIndex(x => x === e);
                if (idx > -1){
                    destroyEnemy(e, idx);
                    hit = true;
                    correctWordAttempts++;
                    break;
                }
            }
        }

        flashMessage(hit ? 'Ï†Å Í≤©Ìá¥!' : 'ÏùºÏπòÌïòÎäî Ï†Å ÏóÜÏùå!', 700);

        wordInput.value = '';
        wordInput.focus();
    }

    function destroyEnemy(enemyData, index){
        if (enemyData.destroyed) return;

        enemyData.destroyed = true;
        enemyData.element.classList.add('destroyed');

        score += enemyData.points;
        scoreDisplay.textContent = score;
        enemiesDefeated++;

        setTimeout(() => {
            if (enemyData.element.parentNode) enemyData.element.remove();
            const currentIndex = enemies.findIndex(e => e === enemyData);
            if (currentIndex > -1) enemies.splice(currentIndex, 1);
            checkWaveEndCondition();
        }, 350);
    }

    function checkWaveEndCondition(){
        if (!isPlaying) return;

        const alive = enemies.filter(e => !e.destroyed).length;
        if (enemiesSpawnedThisWave >= enemiesThisWave && alive === 0){
            clearTimeout(waveInterval);
            messageBox.textContent = `Ïõ®Ïù¥Î∏å ${wave} Î∞©Ïñ¥ ÏÑ±Í≥µ! Îã§Ïùå Ïõ®Ïù¥Î∏å Ï§ÄÎπÑ...`;
            waveInterval = setTimeout(startNextWave, WAVE_DELAY);
        }
    }

    function endGame(){
        isPlaying = false;
        clearInterval(gameInterval);
        clearTimeout(waveInterval);

        wordInput.disabled = true;
        wordInput.placeholder = 'Í≤åÏûÑ Ï¢ÖÎ£å!';
        startButton.disabled = false;
        resetButton.disabled = false;

        const accuracy = totalWordAttempts > 0
            ? Math.round((correctWordAttempts / totalWordAttempts) * 100)
            : 0;

        resultScoreElement.textContent = String(score);
        resultWaveElement.textContent = String(wave);
        resultEnemiesElement.textContent = String(enemiesDefeated);
        resultAccuracyElement.textContent = `${accuracy}%`;

        openModal();
    }

    function resetGame(){
        isPlaying = false;
        clearInterval(gameInterval);
        clearTimeout(waveInterval);

        document.querySelectorAll('.enemy').forEach(el => el.remove());
        enemies = [];

        score = 0;
        lives = MAX_LIVES;
        wave = 0;
        enemiesDefeated = 0;
        totalWordAttempts = 0;
        correctWordAttempts = 0;

        scoreDisplay.textContent = score;
        livesDisplay.textContent = lives;
        waveDisplay.textContent = wave;

        messageBox.textContent = 'ÏãúÏûë Î≤ÑÌäºÏùÑ ÎàåÎü¨ Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!';

        wordInput.value = '';
        wordInput.disabled = true;
        wordInput.placeholder = 'Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÏó¨ Ïô∏Í≥ÑÏù∏ Í≤©Ìá¥!';

        startButton.disabled = false;
        resetButton.disabled = true;

        closeModal();
    }

    function flashMessage(text, ms=900){
        messageBox.textContent = text;
        if (!ms) return;
        setTimeout(() => { if (isPlaying) messageBox.textContent = ''; }, ms);
    }
</script>
</body>
</html>
