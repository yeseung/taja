<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Typing Practice</title>
    <style>
        :root{
            --bg:#ffffff;
            --panel:#ffffffcc;
            --text:#0f172a;
            --muted:#64748b;
            --line:#e5e7eb;
            --shadow: 0 18px 60px rgba(2,6,23,.10);
            --radius: 18px;

            --ok-bg: rgba(22,163,74,.12);
            --ok-line: rgba(22,163,74,.30);
            --bad-bg: rgba(239,68,68,.12);
            --bad-line: rgba(239,68,68,.30);
            --focus: rgba(37,99,235,.14);
            --accent:#2563eb;
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo","Malgun Gothic", sans-serif;
            background:
                    radial-gradient(1100px 700px at 18% 0%, #f3f6ff, #ffffff 55%) fixed;
            color:var(--text);
            overflow-x:hidden;
        }

        .entire{
            min-height:100%;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:20px;
        }

        .wrapper{
            width:min(980px, 100%);
            background:var(--panel);
            backdrop-filter: blur(10px);
            border:1px solid var(--line);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            padding:18px;
        }

        .menubar{
            display:flex;
            gap:12px;
            align-items:center;
            justify-content:space-between;
            flex-wrap:wrap;
            padding-bottom:14px;
            border-bottom:1px solid var(--line);
            margin-bottom:14px;
        }

        .texts-list select{
            height:42px;
            padding:0 12px;
            border-radius:14px;
            border:1px solid var(--line);
            background:#fff;
            color:var(--text);
            outline:none;
            min-width:220px;
        }
        .texts-list select:focus{
            border-color:#bfdbfe;
            box-shadow:0 0 0 5px var(--focus);
        }

        .introduce{
            display:flex;
            gap:10px;
            align-items:center;
            flex-wrap:wrap;
            justify-content:flex-end;
        }

        .pill{
            background:#fff;
            border:1px solid var(--line);
            border-radius:999px;
            padding:8px 12px;
            font-size:13px;
            color:var(--muted);
            display:flex;
            gap:8px;
            align-items:center;
            white-space:nowrap;
        }
        .pill b{color:var(--text)}

        .clear-best-rate{
            height:38px;
            padding:0 12px;
            border-radius:12px;
            border:1px solid var(--line);
            background:#fff;
            cursor:pointer;
            font-weight:700;
            color:var(--text);
        }
        .clear-best-rate:active{transform:translateY(1px)}
        .clear-best-rate:hover{border-color:#cbd5e1}

        .typing{
            display:grid;
            grid-template-columns: 1fr;
            gap:12px;
        }

        .set{
            display:grid;
            grid-template-columns: 1fr;
            gap:8px;
            padding:12px;
            background:#fff;
            border:1px solid var(--line);
            border-radius:16px;
        }

        .text-display{
            font-size:16px;
            line-height:1.55;
            padding:10px 12px;
            border-radius:14px;
            border:1px dashed var(--line);
            color:var(--text);
            background: #fafafa;
            word-break:keep-all;
        }

        .typing-input{
            height:44px;
            padding:0 12px;
            border-radius:14px;
            border:1px solid var(--line);
            outline:none;
            font-size:16px;
            transition: box-shadow .15s, border-color .15s, background .15s;
            background:#fff;
        }
        .typing-input:focus{
            border-color:#bfdbfe;
            box-shadow:0 0 0 5px var(--focus);
        }

        .typing-input.state-ok{
            background:var(--ok-bg);
            border-color:var(--ok-line);
        }
        .typing-input.state-bad{
            background:var(--bad-bg);
            border-color:var(--bad-line);
        }

        .footer-hint{
            margin-top:12px;
            font-size:12px;
            color:var(--muted);
            line-height:1.45;
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            align-items:center;
            justify-content:space-between;
        }
        .footer-hint .dot{
            width:8px;height:8px;border-radius:50%;
            display:inline-block;
            background:var(--accent);
            margin-right:6px;
        }

        @media (min-width: 860px){
            .typing{
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
<div class="entire">
    <div class="wrapper">
        <div class="menubar">
            <div class="texts-list">
                <select id="text-selection">
                    <option value="" hidden>ê¸€ëª©ë¡ ì„ íƒ</option>
                </select>
            </div>

            <div class="introduce">
                <div class="pill rate">â±ï¸ í˜„ì¬: <b>00:00</b></div>
                <div class="pill best-rate">ğŸ† ìµœê³  ê¸°ë¡: <b>--:--</b></div>
                <button class="clear-best-rate" type="button">ê¸°ë¡ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div class="typing">
            <div class="set" id="set1">
                <div class="text-display" id="text-display-1">ê¸€ëª©ë¡ì„ ì„ íƒí•˜ì„¸ìš”.</div>
                <input type="text" class="typing-input" id="typing-input-1" autocomplete="off" />
            </div>
            <div class="set" id="set2">
                <div class="text-display" id="text-display-2"></div>
                <input type="text" class="typing-input" id="typing-input-2" autocomplete="off" />
            </div>
            <div class="set" id="set3">
                <div class="text-display" id="text-display-3"></div>
                <input type="text" class="typing-input" id="typing-input-3" autocomplete="off" />
            </div>
            <div class="set" id="set4">
                <div class="text-display" id="text-display-4"></div>
                <input type="text" class="typing-input" id="typing-input-4" autocomplete="off" />
            </div>
        </div>

        <div class="footer-hint">
            <div><span class="dot"></span>Enterë¡œ ë‹¤ìŒ ì¤„ ì´ë™ / 4ì¤„ ì™„ë£Œ ì‹œ ë‹¤ìŒ 4ë¬¸ì¥ ë¡œë“œ</div>
            <div>ì •ë‹µ: ì´ˆë¡ / ì˜¤ë‹µ: ë¹¨ê°• (ì™„ì „ ì¼ì¹˜ ê¸°ì¤€)</div>
        </div>
    </div>
</div>

<!-- âœ… texts.jsonì„ ì™¸ë¶€íŒŒì¼ ì—†ì´ HTMLì— í¬í•¨ -->
<script id="texts-data" type="application/json">
    {
        "texts": [
            {
                "title": "ì• êµ­ê°€",
                "sentences": [
                    "1. ë™í•´ ë¬¼ê³¼ ë°±ë‘ì‚°ì´ ë§ˆë¥´ê³  ë‹³ë„ë¡",
                    "í•˜ëŠë‹˜ì´ ë³´ìš°í•˜ì‚¬ ìš°ë¦¬ë‚˜ë¼ ë§Œì„¸",
                    "ë¬´ê¶í™” ì‚¼ì²œë¦¬ í™”ë ¤ ê°•ì‚°",
                    "ëŒ€í•œ ì‚¬ëŒ ëŒ€í•œìœ¼ë¡œ ê¸¸ì´ ë³´ì „í•˜ì„¸",
                    "2. ë‚¨ì‚° ìœ„ì— ì € ì†Œë‚˜ë¬´ ì² ê°‘ì„ ë‘ë¥¸ ë“¯",
                    "ë°”ëŒ ì„œë¦¬ ë¶ˆë³€í•¨ì€ ìš°ë¦¬ ê¸°ìƒì¼ì„¸",
                    "3. ê°€ì„ í•˜ëŠ˜ ê³µí™œí•œë° ë†’ê³  êµ¬ë¦„ ì—†ì´",
                    "ë°ì€ ë‹¬ì€ ìš°ë¦¬ ê°€ìŠ´ ì¼í¸ë‹¨ì‹¬ì¼ì„¸",
                    "4. ì´ ê¸°ìƒê³¼ ì´ ë§˜ìœ¼ë¡œ ì¶©ì„±ì„ ë‹¤í•˜ì—¬",
                    "ê´´ë¡œìš°ë‚˜ ì¦ê±°ìš°ë‚˜ ë‚˜ë¼ ì‚¬ë‘í•˜ì„¸",
                    "ë¬´ê¶í™” ì‚¼ì²œë¦¬ í™”ë ¤ ê°•ì‚°",
                    "ëŒ€í•œ ì‚¬ëŒ ëŒ€í•œìœ¼ë¡œ ê¸¸ì´ ë³´ì „í•˜ì„¸"
                ]
            },
            {
                "title": "ìš´ìˆ˜ ì¢‹ì€ ë‚ (ì¼ë¶€)",
                "sentences": [
                    "ìƒˆì¹¨í•˜ê²Œ íë¦° í’ˆì´ ëˆˆì´ ì˜¬ ë“¯í•˜ë”ë‹ˆ,",
                    "ëˆˆì€ ì•„ë‹ˆ ì˜¤ê³  ì–¼ë‹¤ê°€ ë§Œ ë¹„ê°€ ì¶”ì ì¶”ì  ë‚´ë¦¬ì—ˆë‹¤.",
                    "ì´ë‚ ì´ì•¼ë§ë¡œ ë™ì†Œë¬¸ ì•ˆì—ì„œ ì¸ë ¥ê±°ê¾¼ ë…¸ë¦‡ì„ í•˜ëŠ”",
                    "ê¹€ì²¨ì§€ì—ê²ŒëŠ” ì˜¤ë˜ê°„ë§Œì—ë„ ë‹¥ì¹œ ìš´ìˆ˜ ì¢‹ì€ ë‚ ì´ì—ˆë‹¤.",
                    "ë¬¸ ì•ˆì—(ê±°ê¸°ë„ ë¬¸ë°–ì€ ì•„ë‹ˆì§€ë§Œ) ë“¤ì–´ê°„ë‹µì‹œëŠ” ì•ì§‘ ë§ˆë‚˜ë‹˜ì„",
                    "ì „ì°»ê¸¸ê¹Œì§€ ëª¨ì…”ë‹¤ ë“œë¦° ê²ƒì„ ë¹„ë¡¯í•˜ì—¬",
                    "í–‰ì—¬ë‚˜ ì†ë‹˜ì´ ìˆì„ê¹Œ í•˜ê³  ì •ë¥˜ì¥ì—ì„œ ì–´ì •ì–´ì •í•˜ë©°",
                    "ë‚´ë¦¬ëŠ” ì‚¬ëŒ í•˜ë‚˜í•˜ë‚˜ì—ê²Œ ê±°ì˜ ë¹„ëŠ” ë“¯í•œ ëˆˆê¸¸ì„ ë³´ë‚´ê³  ìˆë‹¤ê°€,",
                    "ë§ˆì¹¨ë‚´ êµì›ì¸ ë“¯í•œ ì–‘ë³µì¥ì´ë¥¼ ë™ê´‘í•™êµê¹Œì§€ íƒœì›Œë‹¤ ì£¼ê¸°ë¡œ ë˜ì—ˆë‹¤.",
                    "ì²« ë²ˆì— ì‚¼ì‹­ ì „, ë‘˜ì§¸ ë²ˆì— ì˜¤ì‹­ ì „ ---",
                    "ì•„ì¹¨ ëŒ“ë°”ëŒì— ê·¸ë¦¬ í‰í•˜ì§€ ì•Šì€ ì¼ì´ì—ˆë‹¤.",
                    "ê·¸ì•¼ë§ë¡œ ì¬ìˆ˜ê°€ ì˜´ë¶™ì–´ì„œ ê·¼ ì—´í˜ ë™ì•ˆ ëˆ êµ¬ê²½ë„ ëª»í•œ ê¹€ì²¨ì§€ëŠ”",
                    "ì‹­ì „ì§œë¦¬ ë°±í†µí™” ì„œ í‘¼, ë˜ëŠ” ë‹¤ì„¯ í‘¼ì´ ì°°ê¹í•˜ê³ ",
                    "ì†ë°”ë‹¥ì— ë–¨ì–´ì§ˆ ì œ ê±°ì˜ ëˆˆë¬¼ì„ í˜ë¦´ ë§Œí¼ ê¸°ë»¤ì—ˆë‹¤.",
                    "ë”êµ¬ë‚˜ ì´ë‚  ì´ë•Œì— ì´ íŒ”ì‹­ ì „ì´ë¼ëŠ” ëˆì´ ê·¸ì—ê²Œ ì–¼ë§ˆë‚˜ ìœ ìš©í•œì§€ ëª°ëë‹¤.",
                    "ì»¬ì»¬í•œ ëª©ì— ëª¨ì£¼ í•œ ì”ë„ ì ì‹¤ ìˆ˜ ìˆê±°ë‹ˆì™€,",
                    "ê·¸ë³´ë‹¤ë„ ì•“ëŠ” ì•„ë‚´ì—ê²Œ ì„¤ë íƒ• í•œ ê·¸ë¦‡ë„ ì‚¬ë‹¤ì¤„ ìˆ˜ ìˆìŒì´ë‹¤."
                ]
            },
            {
                "title": "ì¶”ê°€ ì¤€ë¹„ ì¤‘",
                "sentences": [
                    "ì¶”ê°€ ì¤€ë¹„ ì¤‘ì— ìˆìŠµë‹ˆë‹¤.",
                    "ì¶”ê°€ ì¤€ë¹„ ì¤‘ì— ìˆìŠµë‹ˆë‹¤.",
                    "ì¶”ê°€ ì¤€ë¹„ ì¤‘ì— ìˆìŠµë‹ˆë‹¤."
                ]
            }
        ]
    }
</script>

<!-- âœ… script.jsë¥¼ ì™¸ë¶€íŒŒì¼ ì—†ì´ HTMLì— í¬í•¨ -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const textSelection = document.getElementById("text-selection");
        const textDisplays = Array.from(document.getElementsByClassName("text-display"));
        const typingInputs = Array.from(document.getElementsByClassName("typing-input"));
        const ratePill = document.querySelector(".rate b");
        const bestPill = document.querySelector(".best-rate b");
        const clearBestRateBtn = document.querySelector(".clear-best-rate");

        // ë‚´ë¶€ JSON ë¡œë“œ
        const dataEl = document.getElementById("texts-data");
        const texts = JSON.parse(dataEl.textContent).texts;

        let currentSentences = [];
        let currentIndex = 0; // 4ì¤„ ë‹¨ìœ„ ì‹œì‘ ì¸ë±ìŠ¤
        let timer = null;
        let startTime = null;

        const LS_KEY = "bestTimes";
        let bestTimes = JSON.parse(localStorage.getItem(LS_KEY)) || {};

        // ì˜µì…˜ ì±„ìš°ê¸°
        texts.forEach((t, idx) => {
            const opt = document.createElement("option");
            opt.value = String(idx);
            opt.textContent = t.title;
            textSelection.appendChild(opt);
        });

        // ===== helpers =====
        function resetInputStates(){
            typingInputs.forEach(inp=>{
                inp.value = "";
                inp.classList.remove("state-ok","state-bad");
            });
        }

        function displaySentences(){
            textDisplays.forEach((el, i) => {
                el.textContent = currentSentences[currentIndex + i] || "";
            });
            resetInputStates();
        }

        function resetTimer(){
            clearInterval(timer);
            timer = null;
            startTime = null;
            ratePill.textContent = "00:00";
        }

        function formatTime(seconds){
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
        }

        function startTimer(){
            startTime = Date.now();
            timer = setInterval(() => {
                const elapsed = (Date.now() - startTime) / 1000;
                ratePill.textContent = formatTime(elapsed);
            }, 100);
        }

        function displayBestTime(title){
            if (bestTimes[title] != null){
                bestPill.textContent = formatTime(bestTimes[title]);
            } else {
                bestPill.textContent = "--:--";
            }
        }

        function selectedTitle(){
            const idx = textSelection.selectedIndex;
            if (idx < 0) return "";
            return textSelection.options[idx].text || "";
        }

        function guardSelected(){
            return textSelection.value !== "";
        }

        // ===== selection change =====
        textSelection.addEventListener("change", () => {
            const selectedIndex = textSelection.value;
            if (selectedIndex === "") return;

            currentSentences = texts[Number(selectedIndex)].sentences || [];
            currentIndex = 0;
            displaySentences();
            resetTimer();
            displayBestTime(texts[Number(selectedIndex)].title);

            // ì²« ë²ˆì§¸ ì¤„ì— í¬ì»¤ìŠ¤
            typingInputs[0].focus();
        });

        // ===== best reset =====
        clearBestRateBtn.addEventListener("click", () => {
            if(!guardSelected()) return;

            const title = selectedTitle();
            delete bestTimes[title];
            localStorage.setItem(LS_KEY, JSON.stringify(bestTimes));
            displayBestTime(title);
            alert("ì„ íƒí•œ ê¸€ì˜ ìµœê³  ê¸°ë¡ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
        });

        // ===== input logic =====
        typingInputs.forEach((input, index) => {
            input.setAttribute("autocomplete", "off");

            input.addEventListener("input", () => {
                if (!guardSelected()) return;

                if (!startTime) startTimer();

                const expected = textDisplays[index].textContent || "";
                const v = input.value;

                // ë¹ˆ ì¤„(ë¬¸ì¥ ì—†ìŒ)ì´ë©´ ìƒíƒœ í‘œì‹œ ì•ˆ í•¨
                if (!expected){
                    input.classList.remove("state-ok","state-bad");
                    return;
                }

                if (v === expected){
                    input.classList.add("state-ok");
                    input.classList.remove("state-bad");
                } else {
                    input.classList.add("state-bad");
                    input.classList.remove("state-ok");
                }
            });

            input.addEventListener("keydown", (e) => {
                if (e.key !== "Enter") return;
                e.preventDefault();
                if (!guardSelected()) return;
                if (!startTime) startTimer();

                const expected = textDisplays[index].textContent || "";
                const v = input.value;

                // ë¬¸ì¥ì´ ì—†ëŠ” ì¤„ì´ë©´ ê·¸ëƒ¥ ë‹¤ìŒìœ¼ë¡œ ì´ë™
                if (!expected){
                    if (index < typingInputs.length - 1) typingInputs[index + 1].focus();
                    else {
                        currentIndex += typingInputs.length;
                        displaySentences();
                        typingInputs[0].focus();
                    }
                    return;
                }

                // EnterëŠ” "ì™„ì „ ì¼ì¹˜"ê°€ ì•„ë‹ˆë©´ ë‹¤ìŒìœ¼ë¡œ ì•ˆ ë„˜ì–´ê°€ê²Œ(ì›ë³¸ ë¡œì§ ìœ ì§€)
                if (v !== expected){
                    // ì‚´ì§ í”ë“¤ë¦¼ ëŠë‚Œ(ê°„ë‹¨)
                    input.animate(
                        [{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(0)"}],
                        {duration:180}
                    );
                    return;
                }

                // ë§ˆì§€ë§‰ ë¬¸ì¥ì¸ì§€ ì²´í¬
                const isLastSentence = (currentIndex + index + 1) >= currentSentences.length;

                if (isLastSentence){
                    clearInterval(timer);
                    timer = null;

                    const elapsed = (Date.now() - startTime) / 1000;
                    const title = selectedTitle();

                    if (bestTimes[title] == null || elapsed < bestTimes[title]){
                        bestTimes[title] = elapsed;
                        localStorage.setItem(LS_KEY, JSON.stringify(bestTimes));
                        displayBestTime(title);
                    }

                    alert("ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!");
                    // ì™„ë£Œ í›„ ì…ë ¥ ë¹„ìš°ê³  íƒ€ì´ë¨¸ ë¦¬ì…‹(ì›í•˜ë©´ ìœ ì§€ë¡œ ë°”ê¿€ ìˆ˜ ìˆìŒ)
                    resetTimer();
                    resetInputStates();
                    typingInputs[0].blur();
                    return;
                }

                // ë‹¤ìŒ ì…ë ¥ì¹¸ í¬ì»¤ìŠ¤ or ë‹¤ìŒ 4ë¬¸ì¥ ë¡œë“œ
                if (index < typingInputs.length - 1){
                    typingInputs[index + 1].focus();
                } else {
                    currentIndex += typingInputs.length;
                    displaySentences();
                    typingInputs[0].focus();
                }
            });
        });

        // ì´ˆê¸° ìƒíƒœ: ì…ë ¥ ë¹„í™œì„±ì€ ì•„ë‹ˆì§€ë§Œ, ì„ íƒ ì „ì—ëŠ” ì˜ë¯¸ê°€ ì—†ìœ¼ë‹ˆ ì•ˆë‚´ìš©ìœ¼ë¡œ blur
        typingInputs.forEach(i => i.value = "");
    });
</script>
</body>
</html>
