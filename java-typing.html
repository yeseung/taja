<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìë°”í”„ë¡œê·¸ë˜ë° íƒ€ìì—°ìŠµ</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <!-- https://github.com/Choi-T-dev/sungl-i-typing -->

    <style>
        body {
            font-family: "Noto Sans KR", Arial, sans-serif;
            background: #eef1f5;
            text-align: center;
            padding: 30px;
        }

        #captureArea, #finalScreen {
            background: white;
            width: 720px;
            margin: auto;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .school { font-size: 15px; color: #555; }

        h1 { margin: 6px 0 20px; }

        .info-box input {
            width: 90px;
            padding: 8px;
            margin: 0 5px;
            text-align: center;
            border-radius: 12px;
            border: 1px solid #ccc;
        }

        button {
            padding: 10px 26px;
            margin-top: 15px;
            border-radius: 12px;
            border: none;
            background: #4a6cf7;
            color: white;
            cursor: pointer;
            font-size: 15px;
        }

        #game {
            position: relative;
            width: 640px;
            height: 320px;
            margin: 20px auto;
            background: #f9fafc;
            border: 2px solid #dcdfe6;
            border-radius: 12px;
        }

        .word {
            position: absolute;
            background: #e6ebff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 16px;
        }

        #input {
            width: 360px;
            padding: 10px;
            font-size: 15px;
            border-radius: 12px;
            border: 1px solid #ccc;
        }

        /* ê²°ê³¼/ì ìˆ˜ ë°•ìŠ¤ */
        .resultBox {
            background-color: rgba(74,108,247,0.2);
            border: 2px solid #4a6cf7;
            color: #000;
            padding: 12px;
            margin-top: 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            display: none; /* ì²˜ìŒì—ëŠ” ìˆ¨ê¹€ */
        }

        #finalScreen { display: none; }

        .explain { text-align: left; margin-top: 20px; }
        .explain p { margin: 8px 0; }

        .praise {
            margin-top: 22px;
            font-size: 18px;
            color: #2e7d32;
            font-weight: bold;
        }
    </style>
</head>

<body>

<div id="captureArea">
    <h1>ìë°”í”„ë¡œê·¸ë˜ë° íƒ€ìì—°ìŠµ</h1>

    <div class="info-box">
        ë°˜ <input id="classNum" type="number" min="9" max="12">
        ë²ˆí˜¸ <input id="studentNum" type="number" min="1" max="25">
        ì´ë¦„ <input id="studentName" maxlength="4">
    </div>

    <button onclick="startGame()">ì‹œì‘</button>

    <div id="game"></div>
    <input id="input" placeholder="ë‹¨ì–´ ì…ë ¥" disabled>

    <div>
        ë‚¨ì€ ì‹œê°„ <span id="time">90</span>ì´ˆ
    </div>

    <!-- ğŸ”¹ ì²« í™”ë©´ ì ìˆ˜/ì†ë„ ë°•ìŠ¤ -->
    <div id="resultBox" class="resultBox"></div>
</div>

<div id="finalScreen">
    <h2>ğŸ“˜ì•ìœ¼ë¡œ ë°°ìš°ê²Œ ë  ìë°” ëª…ë ¹ì–´ë“¤</h2>

    <div class="explain">
        <p>â–¶ï¸ <b>class</b> : ê°ì²´ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í‹€</p>
        <p>â–¶ï¸ <b>public static void main</b> : í”„ë¡œê·¸ë¨ì´ ì‹œì‘ë˜ëŠ” ë¶€ë¶„</p>
        <p>â–¶ï¸ <b>if / for / while</b> : ì¡°ê±´ì„ í™•ì¸í•˜ê³  ë°˜ë³µí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´</p>
        <p>â–¶ï¸ <b>ArrayList / HashMap</b> : ë°ì´í„°ë¥¼ ë‹´ì•„ë‘ëŠ” ìƒì</p>
        <p>â–¶ï¸ <b>try / catch</b> : í”„ë¡œê·¸ë¨ì´ ì˜¤ë¥˜ê°€ ë‚˜ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” êµ¬ë¬¸</p>
    </div>

    <div class="praise" id="praiseText"></div>

    <!-- ğŸ”¹ ë‹¤ìŒ í™”ë©´ì—ë„ ë™ì¼í•œ ë°•ìŠ¤ í‘œì‹œ -->
    <div id="finalResultBox" class="resultBox"></div>

    <button onclick="location.reload()">ì¬ì‹œë„</button>
</div>

<script>
    const words = [
        "class","public","static","void","int","double","boolean",
        "if","else","for","while",
        "ArrayList","HashMap","Scanner",
        "try","catch","finally","throw","Exception",
        "thread","Runnable"
    ];

    const game = document.getElementById("game");
    const input = document.getElementById("input");
    const timeEl = document.getElementById("time");
    const resultBox = document.getElementById("resultBox");
    const finalResultBox = document.getElementById("finalResultBox");
    const praiseText = document.getElementById("praiseText");

    const classNum = document.getElementById("classNum");
    const studentNum = document.getElementById("studentNum");
    const studentName = document.getElementById("studentName");

    let score = 0;
    let time = 90;
    let timer, spawner;
    let activeWords = [];
    let startTime = 0;

    function validInfo() {
        return classNum.value >= 9 && classNum.value <= 12 &&
            studentNum.value >= 1 && studentNum.value <= 25 &&
            /^[ê°€-í£]{1,4}$/.test(studentName.value);
    }

    function startGame() {
        if (!validInfo()) {
            alert("ë°˜(9~12), ë²ˆí˜¸(1~25), ì´ë¦„(í•œê¸€ 4ì ì´ë‚´)ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        score = 0;
        time = 90;
        activeWords = [];
        game.innerHTML = "";
        timeEl.textContent = time;
        input.disabled = false;
        input.value = "";
        input.focus();

        startTime = Date.now();

        timer = setInterval(() => {
            time--;
            timeEl.textContent = time;
            if(time <= 0) endGame();
        },1000);

        spawner = setInterval(spawnWord, 900);
    }

    function spawnWord() {
        if (activeWords.length >= 6) return;

        let word;
        do {
            word = words[Math.floor(Math.random() * words.length)];
        } while (activeWords.includes(word));

        activeWords.push(word);

        const div = document.createElement("div");
        div.className = "word";
        div.textContent = word;
        div.style.left = Math.random() * 560 + "px";
        div.style.top = Math.random() * 280 + "px";
        game.appendChild(div);
    }

    input.addEventListener("input", () => {
        const value = input.value.trim();
        const index = activeWords.indexOf(value);
        if (index !== -1) {
            activeWords.splice(index,1);
            [...document.querySelectorAll(".word")]
            .find(w=>w.textContent===value).remove();
            score++;
            input.value = "";
        }
    });

    function endGame() {
        clearInterval(timer);
        clearInterval(spawner);
        input.disabled = true;

        const elapsedSec = (Date.now() - startTime)/1000;
        const wpm = Math.round((score / elapsedSec) * 60);

        // ğŸ”¹ ì²« í™”ë©´ ë°•ìŠ¤ ì—…ë°ì´íŠ¸ ë° ë³´ì´ê¸°
        resultBox.textContent = `ë°˜: ${classNum.value} | ë²ˆí˜¸: ${studentNum.value} | ì´ë¦„: ${studentName.value} | ì ìˆ˜: ${score}ì  | ì†ë„: ${wpm} WPM`;
        resultBox.style.display = "block";

        html2canvas(document.getElementById("captureArea")).then(canvas => {
            const now = new Date();
            const date =
                      now.getFullYear() + "-" +
                      String(now.getMonth() + 1).padStart(2,"0") + "-" +
                      String(now.getDate()).padStart(2,"0");

            const link = document.createElement("a");
            link.download =
                `${classNum.value}ë°˜_${studentNum.value}ë²ˆ_${studentName.value}_${date}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();

            // ğŸ”¹ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ ì´ë™
            document.getElementById("captureArea").style.display="none";
            document.getElementById("finalScreen").style.display="block";

            // ğŸ”¹ ë‹¤ìŒ í™”ë©´ ë°•ìŠ¤ì—ë„ ë™ì¼í•˜ê²Œ í‘œì‹œ
            finalResultBox.textContent = `ë°˜: ${classNum.value} | ë²ˆí˜¸: ${studentNum.value} | ì´ë¦„: ${studentName.value} | ì ìˆ˜: ${score}ì  | ì†ë„: ${wpm} WPM`;
            finalResultBox.style.display = "block";

            praiseText.textContent =
                "90ì´ˆ ë™ì•ˆ ëê¹Œì§€ ì§‘ì¤‘í•˜ë©° ë„ì „í•œ ëª¨ìŠµì´ ì •ë§ í›Œë¥­í•©ë‹ˆë‹¤! ğŸ‘ " +
                "ìë°” í•µì‹¬ í‚¤ì›Œë“œë¥¼ ì„±ì‹¤í•˜ê²Œ ì…ë ¥í•˜ë©° í•™ìŠµì— ì„í•˜ëŠ” íƒœë„ê°€ ì¸ìƒì ì´ì—ˆì–´ìš”. " +
                "ì´ëŸ° ê¾¸ì¤€í•¨ì€ ë¶„ëª… í° ì‹¤ë ¥ìœ¼ë¡œ ì´ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤!ğŸŒŸ";
        });
    }
</script>

</body>
</html>